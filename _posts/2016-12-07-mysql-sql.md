---
layout: post
title:  MySQL 疑难 SQL
date:   2016-12-07 19:57:05
categories: MySQL
---

* content
{:toc}

## 补充自增主键

	alter table `表格名` add column `列名` int not null auto_increment primary key comment '主键' first;

## 分组排序取前N条记录

建表并初始化数据：

	CREATE TABLE lin(
		id integer NOT NULL,
		type varchar(1) , 
		CONSTRAINT lin_pkey PRIMARY KEY (id) 
	);

	INSERT INTO lin(id, type) VALUES (1, 'a'),(2, 'a'),(3, 'a'),(4, 'b'),(5, 'b'),(6, 'b'),(7, 'b'),(8, 'c'),(9, 'c'),(10, 'c');
	
执行查询：

	select * from lin a where (select count(1) from lin b where a.type = b.type and a.id < b.id) < 2
	
执行结果为：

	+----+------+
	| id | type |
	+----+------+
	|  2 | a    |
	|  3 | a    |
	|  6 | b    |
	|  7 | b    |
	|  9 | c    |
	| 10 | c    |
	+----+------+
	
SQL解释：

1. 子查询是查询所有和当前记录type一样但是id比当前记录大的记录的总和  
2. type和当前记录一样，但是id比当前记录大的记录如果大于或者等于两个，说明当前至少排在第三个
3. type和当前记录一样，但是id比当前记录大的记录如果小于两个，说明当前记录可以排在前两个

	