---
layout: post
title:  "MongoDB 基本操作"
date:   2015-08-19 14:26:05
categories: MongoDB
---

* content
{:toc}

	help                                     #mongodb支持的命令
	show dbs                                 #查看所有数据库
	use test                                 #使用 test 库
	db                                       #查看当前连接在哪个数据库
	show collections                         #查看所有的collection 
	db.help()                                #当前数据库支持哪些方法
	db.user.help()                           #当前数据库下的表或者表collection支持的方法
	 
	db.foo.find()                            #查找所有
	db.foo.findOne()                         #查找一条记录
	db.foo.find({'msg':'Hello 1'}).limit(10) #根据条件检索10条记录
	 
	db.test.drop()                           #删除collection test
	db.dropDatabase()                        #删除当前的数据库
	db.foo.remove({'yy':5})                  #删除yy=5的记录 
	db.foo.remove({})                        #删除所有的记录

	#释放存储
	mongoldb删除记录后存储并不会释放
	如果要释放存储可以：先删除记录，再导出数据，再导入数据
	remove…
	mongodump -o path
	mongorestore -d database_name path

	#模糊查询
	tname字段包含关键字“aa”
	db.test.find({"tname": {$regex: 'aa', $options:'i'}}) 
	db.test.find({"tname": {$regex:/aa.*/i}}) 

	#停止服务
	./mongo -host ip:port  #进入mongodb
	>use  admin #使用admin库
	>db.shutdownServer(); #关闭服务
	 
	#存储
	db.foo.save(...)
	 
	#根据query条件修改，如果不存在则插入，允许修改多条记录
	db.foo.update({'yy':5},{'$set':{'xx':2}},upsert=true,multi=true)

	[normal] = [-h ip] [—-port port] [-u user] [-p pwd]
	
	#导出整个库
	./mongodump [normal] [-d dbname] -o path
	-d:有则导出制定库，无责导出所有库

	#导入整个库
	./mongorestore [normal] [-d dbname] [--drop] path
	--drop:先删除当前数据，然后恢复备份的数据，慎用

	#导出表
	./mongoexport [normal] -d dbname -c 表名 -f 字段 -q 条件 -o 文件
	eg:
	./mongoexport -d test -c students -o students.dat
	./mongoexport -d test -c students --csv -f classid,name,age -q '{"age":30}' -o students_csv.dat

	#导入表
	./mongoimport [normal] -d dbname -c 表名 --upsert 字段 --drop 文件
	--upsert 插入或者更新现有数据，和--upsertFields一样
	eg:
	./mongoimport -d test -c students students.dat
	./mongoimport -d test -c students --upsertFields classid,name,age students_csv.dat
	./mongoimport -d test -c students --type csv --headerline --file students_csv.dat 
	—-type:指明要导入的文件格式
	—-headerline:指明第一行是列名，不需要导入
	—-file：指明要导入的文件
	


